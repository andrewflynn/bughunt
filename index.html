<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BugHunt - Web Edition</title>
    <style>
        body {
            background-color: #222;
            color: #eee;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        h1 { margin: 10px 0; font-size: 32px; text-shadow: 2px 2px #000; }
        
        #gameContainer {
            position: relative;
            border: 4px solid #555;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            width: 90vw;
            max-width: 960px;
            aspect-ratio: 4 / 3;
        }
        
        canvas {
            display: block;
            background-color: #000;
            width: 100%;
            height: 100%;
            /* Keeps the retro pixel-art crispness */
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        #ui {
            margin-top: 15px;
            text-align: center;
            width: 90vw;
            max-width: 960px;
        }
        .controls {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 10px;
        }
        kbd {
            background-color: #eee;
            border-radius: 3px;
            border: 1px solid #b4b4b4;
            color: #333;
            display: inline-block;
            font-size: .85em;
            font-weight: 700;
            padding: 2px 6px;
        }
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: yellow;
            font-size: 48px;
            font-weight: bold;
            text-shadow: 3px 3px #000;
            display: none;
            text-align: center;
            pointer-events: none;
            width: 100%;
            line-height: 1.2;
        }
    </style>
</head>
<body>

    <h1>BUGHUNT</h1>

    <div id="gameContainer">
        <canvas id="gameCanvas" width="640" height="480"></canvas>
        <div id="message"></div>
    </div>

    <div id="ui">
        <div class="controls">
            <strong>Controls:</strong> <kbd>NumPad</kbd> or <kbd>Arrow Keys</kbd> (Home/End for diagonals).<br>
            Goal: Navigate from Top-Left to Bottom-Right.<br>
            Press <kbd>Space</kbd> or <kbd>Enter</kbd> to Start/Restart.
        </div>
        <div style="margin-top: 15px; font-size: 18px;">
            <label for="speedRange">Speed:</label>
            <input type="range" id="speedRange" min="1" max="15" value="5">
            <span id="speedDisplay">5</span>
        </div>
    </div>

<script>
/**
 * BUGHUNT - Web Port
 * Original Logic adapted from QuickBASIC.
 */

// We wait until the entire window loads to prevent sandbox/iframe early-execution errors.
window.addEventListener('load', function() {

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const msgEl = document.getElementById('message');
    const speedRange = document.getElementById('speedRange');
    const speedDisplay = document.getElementById('speedDisplay');

    // Collision Canvas (Offscreen map)
    const wallCanvas = document.createElement('canvas');
    wallCanvas.width = 640;
    wallCanvas.height = 480;
    const wallCtx = wallCanvas.getContext('2d');

    // Game State
    let gameState = 'MENU'; 
    let gameSpeed = 5; 
    let frameCount = 0;

    // The Bug Sprite Data
    const bug = {
        x: 28,
        y: 28,
        width: 24,
        height: 20,
        dx: 0,
        dy: 0,
        color1: '#00AA00', 
        color2: '#5555FF', 
        color3: '#AA5500', 
    };

    // Kept on one single line to prevent HTML parser breakages in simple editors
    const MAZE_STR = "BH200 BL10 D50 L40 D40 R60 U90 L20 BD70 BL90 D80 R70 D20 L90 U100 R20 BR170 BD20 D60 L40 D80 L60 D60 R80 U40 R60 U40 L20 U60 R40 U60 L60 BU60 R120 D80 R60 U100 L180 D20 BD200 BL170 D80 L20 U80 R20 BD120 BR40 D80 R100 U60 R80 U40 R20 U20 L40 D40 L160 BU180 BR240 D180 R100 U160 L60 U20 L40 BU40 BR120 U90 R20 D20 R100 U20 R20 D40 R20 D40 L60 D60 L40 U50 L60 BR60 BD120 R60 D80 L20 U40 L40 U40 BD120 BL100 D60 R120 U40 L20 U20 L100 BL370 BU370 BR230 U30 R30 D30 L30 BR20 BD100 R40 D30 L40 U30";

    function init() {
        // Draw the collision map once in the background
        drawMazeToCanvas(wallCtx, MAZE_STR);
        
        // Draw the visible playing field
        ctx.fillStyle = "#0
